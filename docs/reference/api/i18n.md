# Internationalization API Reference

Multi-language support with i18next and i18n-node.

## Module Organization

```
@sentzunhat/zacatl/localization
├── /core          - Factory functions (createI18n, createI18nAsync)
├── /adapters      - Translation loaders (Filesystem, Memory)
├── /i18n-node     - HTTP request localization (configureI18nNode)
├── /types         - Type definitions (I18nPort, I18nConfig, I18nInstance)
└── /schemas       - Validation schemas (i18nConfigSchema)
```

## Import

```typescript
// Main factory function
import { createI18n, createI18nAsync } from "@sentzunhat/zacatl";

// Types
import type { I18nPort, I18nConfig, I18nInstance } from "@sentzunhat/zacatl";

// Adapters
import { FilesystemAdapter, MemoryAdapter } from "@sentzunhat/zacatl";

// i18n-node (for HTTP servers)
import { configureI18nNode } from "@sentzunhat/zacatl";
```

## Core API

### `createI18n(adapter?, config?)`

Creates a new i18next instance.

```typescript
const i18n = createI18n(); // Uses FilesystemAdapter by default
```

**Parameters:**

- `adapter?: I18nPort` - Translation loader (defaults to `FilesystemAdapter('./src/localization/locales')`)
- `config?: I18nConfig` - Configuration options

**Returns:** `I18nInstance`

### `createI18nAsync(adapter?, config?)`

Async version of `createI18n` for adapters with async initialization.

```typescript
const i18n = await createI18nAsync(myAsyncAdapter);
```

## i18n-node API

### `configureI18nNode(input?)`

Configures the singleton i18n-node instance for HTTP request localization.

```typescript
import { configureI18nNode } from "@sentzunhat/zacatl";

configureI18nNode({
  locales: {
    default: "en",
    supported: ["en", "es", "fr"],
    directories: ["./locales"],
  },
  objectNotation: true,
  overrideBuiltIn: true,
});
```

**Parameters:**

- `input?.locales.default` - Default locale (e.g., "en")
- `input?.locales.supported` - Array of supported locales
- `input?.locales.directories` - Additional locale directories to merge
- `input?.objectNotation` - Enable nested key support (default: true)
- `input?.overrideBuiltIn` - App translations override Zacatl's (default: true)

## Adapters

### `FilesystemAdapter`

Loads translations from JSON files.

```typescript
import { FilesystemAdapter, createI18n } from "@sentzunhat/zacatl";

const i18n = createI18n(new FilesystemAdapter("./src/localization/locales"));
```

**Expected structure:** `localesDir/language.json`

### `MemoryAdapter`

In-memory translations (useful for testing).

```typescript
import { MemoryAdapter, createI18n } from "@sentzunhat/zacatl";

const i18n = createI18n(
  new MemoryAdapter({
    en: { translation: { greeting: "Hello" } },
    es: { translation: { greeting: "Hola" } },
  }),
);
```

## Custom Adapter

Implement the `I18nPort` interface:

```typescript
import type { I18nPort } from "@sentzunhat/zacatl";

class MyAdapter implements I18nPort {
  async init?() {
    // Optional initialization
  }

  loadResources(language: string, namespace: string) {
    // Load and return translations
    return { greeting: "Hello" };
  }

  saveResources?(
    language: string,
    namespace: string,
    resources: Record<string, unknown>,
  ) {
    // Optional: Save translations
  }
}
```

## Usage Examples

### Basic Translation

```typescript
i18n.t("welcome"); // "Welcome"

await i18n.setLanguage("es");
i18n.t("welcome"); // "Bienvenido"
```

### With Variables (Interpolation)

```typescript
// en.json: { "greeting": "Hello, {{name}}!" }
i18n.t("greeting", { name: "John" }); // "Hello, John!"
```

### Nested Keys (Object Notation)

```typescript
// en.json
{
  "errors": {
    "notFound": "Resource not found",
    "validation": "Invalid input"
  }
}

i18n.t("errors.notFound"); // "Resource not found"
```

## File Structure

```
locales/
├── en.json
├── es.json
└── fr.json
```

**Example `en.json`:**

```json
{
  "greeting": "Hello {{name}}",
  "errors": {
    "notFound": "Not found",
    "validation": "Invalid input"
  }
}
```

---

**Next**: [Repository →](./repository.md)
