# Migration Guide: v0.0.23 ‚Üí v0.0.24

## üö® Critical Bug Fix

**Version 0.0.24 fixes a critical bug where ORMs were eagerly loaded when importing anything from the main package.**

This caused mongoose/sequelize to load immediately, breaking applications that don't use these ORMs.

## Breaking Changes

### ORM Exports Removed from Main Package

**Before (v0.0.23):**

```typescript
// This worked but caused eager loading
import { Service, mongoose, Schema } from "@sentzunhat/zacatl";
```

**After (v0.0.24):**

```typescript
// ‚úÖ Use dedicated subpath imports
import { Service } from "@sentzunhat/zacatl";
import { mongoose, Schema } from "@sentzunhat/zacatl/third-party/mongoose";
```

## Migration Steps

### 1. Update Package Version

```bash
npm install @sentzunhat/zacatl@0.0.24
```

### 2. Update Imports

Find and replace ORM imports:

```typescript
// ‚ùå Remove these imports
import { mongoose, Schema, Model } from "@sentzunhat/zacatl";
import { Sequelize, DataTypes } from "@sentzunhat/zacatl";

// ‚úÖ Replace with subpath imports
import {
  mongoose,
  Schema,
  Model,
} from "@sentzunhat/zacatl/third-party/mongoose";
import { Sequelize, DataTypes } from "@sentzunhat/zacatl/third-party/sequelize";
```

### 3. Verify Other Imports Still Work

These imports are **unchanged** and continue to work:

```typescript
import { Service, resolveDependency } from "@sentzunhat/zacatl";
import { BaseRepository } from "@sentzunhat/zacatl/infrastructure";
import { CustomError } from "@sentzunhat/zacatl/errors";
import { loadConfig } from "@sentzunhat/zacatl/config";
```

## Why This Change?

### The Problem (v0.0.23)

```typescript
// Even if you only wanted Service...
import { Service } from "@sentzunhat/zacatl";

// ...mongoose and sequelize were EAGERLY LOADED
// This broke apps without mongoose installed
```

### The Solution (v0.0.24)

```typescript
// Service import is clean - no ORM loading
import { Service } from "@sentzunhat/zacatl";

// ORMs only load when explicitly imported
import { mongoose } from "@sentzunhat/zacatl/third-party/mongoose";
```

## Package.json Exports Configuration

The conditional exports in `package.json` remain unchanged:

```json
{
  "exports": {
    ".": "./build/index.js",
    "./orm/mongoose": "./build/orm/mongoose.js",
    "./orm/sequelize": "./build/orm/sequelize.js",
    "./application": "./build/service/architecture/application/index.js"
  }
}
```

## Automated Migration Script

```bash
# Find all imports from main package
grep -r "import.*from.*@sentzunhat/zacatl" src/

# Use sed to update (backup first!)
find src -name "*.ts" -exec sed -i.bak \
  's/import { \(.*mongoose.*\) } from "@sentzunhat\/zacatl"/import { \1 } from "@sentzunhat\/zacatl\/orm\/mongoose"/g' {} \;
```

## Benefits After Migration

1. **No Eager Loading** - ORMs only load when you need them
2. **Tree-Shaking** - Bundlers can eliminate unused ORMs
3. **Faster Startup** - Applications load only required dependencies
4. **Cleaner Dependencies** - Use zacatl without installing mongoose/sequelize

## Need Help?

- See [ORM Import Strategies Guide](../guides/orm-import-strategies.md)
- Check [Examples](../examples/)
- File an issue: [GitHub Issues](https://github.com/sentzunhat/zacatl/issues)
