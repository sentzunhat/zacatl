# Migration Guide to @sentzunhat/zacatl v0.0.21

This guide helps you upgrade your existing project to use the improved module exports in v0.0.21.

## What's New in v0.0.21

### âœ¨ Developer Experience Improvements

1. **ðŸ“¦ Package Exports Map** - Shorter, cleaner import paths
2. **ðŸ§ª Bun Test Support** - Dedicated test scripts for Bun runtime
3. **ðŸ”„ Backward Compatibility** - All old import paths still work
4. **ðŸ“š Better Tree-Shaking** - More granular imports for smaller bundles

### ðŸŽ¯ No Breaking Changes

This is a **purely additive release** - all existing code will continue to work without modifications.

---

## Migration Checklist

### Step 1: Update Package Version

```bash
npm install @sentzunhat/zacatl@0.0.21
# or
yarn add @sentzunhat/zacatl@0.0.21
# or
bun add @sentzunhat/zacatl@0.0.21
```

### Step 2: (Optional) Use Shorter Import Paths

You can now use cleaner import paths for common modules:

#### Before (still works)

```typescript
import {
  BaseRepository,
  ORMType,
} from "@sentzunhat/zacatl/build/service/architecture/infrastructure/repositories/abstract";
import {
  CustomError,
  BadRequestError,
} from "@sentzunhat/zacatl/build/error/index";
import { loadConfig } from "@sentzunhat/zacatl/build/configuration/index";
```

#### After (recommended)

```typescript
import { BaseRepository, ORMType } from "@sentzunhat/zacatl/infrastructure";
import { CustomError, BadRequestError } from "@sentzunhat/zacatl/errors";
import { loadConfig } from "@sentzunhat/zacatl/config";
```

---

## Available Export Shortcuts

| Old Path                                                                             | New Shortcut                        | What's Included                                            |
| ------------------------------------------------------------------------------------ | ----------------------------------- | ---------------------------------------------------------- |
| `@sentzunhat/zacatl/build/service/architecture/infrastructure/repositories/abstract` | `@sentzunhat/zacatl/infrastructure` | `BaseRepository`, `ORMType`, repository abstractions       |
| `@sentzunhat/zacatl/build/error/index`                                               | `@sentzunhat/zacatl/errors`         | All error classes (`CustomError`, `BadRequestError`, etc.) |
| `@sentzunhat/zacatl/build/configuration/index`                                       | `@sentzunhat/zacatl/config`         | `loadConfig`, configuration utilities                      |
| `@sentzunhat/zacatl/build/service/architecture/domain/index`                         | `@sentzunhat/zacatl/domain`         | Domain layer exports                                       |
| `@sentzunhat/zacatl/build/service/architecture/application/index`                    | `@sentzunhat/zacatl/application`    | Application layer exports                                  |

---

## Examples

### Repository with Shorter Imports

```typescript
import { BaseRepository, ORMType } from "@sentzunhat/zacatl/infrastructure";
import { CustomError } from "@sentzunhat/zacatl/errors";
import { injectable } from "tsyringe";

@injectable()
export class UserRepository extends BaseRepository<User> {
  constructor() {
    super({
      orm: ORMType.MONGOOSE,
      model: UserModel,
      modelName: "User",
    });
  }

  async findByEmail(email: string): Promise<User | null> {
    const user = await this.findOne({ email });
    if (!user) {
      throw new CustomError("User not found", 404);
    }
    return user;
  }
}
```

### Error Handling with Shorter Imports

```typescript
import { BadRequestError, UnauthorizedError } from "@sentzunhat/zacatl/errors";

export class AuthService {
  async login(email: string, password: string) {
    if (!email || !password) {
      throw new BadRequestError("Email and password are required");
    }

    const user = await this.userRepo.findByEmail(email);
    if (!user || !user.validatePassword(password)) {
      throw new UnauthorizedError("Invalid credentials");
    }

    return user;
  }
}
```

### Configuration with Shorter Imports

```typescript
import { loadConfig } from "@sentzunhat/zacatl/config";

const config = await loadConfig();
console.log(config.server.port); // 3000
```

---

## Bun Support

If you're using Bun, you can now run tests with the dedicated script:

```bash
# Run tests with Bun
npm run test:bun

# Run tests with Node.js (Vitest)
npm run test:node

# Original test command (uses Vitest)
npm run test
```

---

## Benefits

### 1. Cleaner Imports

**Before:**

```typescript
import { BaseRepository } from "@sentzunhat/zacatl/build/service/architecture/infrastructure/repositories/abstract";
```

**After:**

```typescript
import { BaseRepository } from "@sentzunhat/zacatl/infrastructure";
```

### 2. Better IDE Autocomplete

Shorter paths make autocomplete suggestions more readable and easier to navigate.

### 3. Easier Documentation

Code examples are now more concise and easier to understand.

### 4. Future-Proof

The exports map provides better control over the public API surface.

---

## Gradual Migration

**You don't need to update all imports at once.** Both old and new paths work simultaneously:

```typescript
// Mix and match - both work!
import { BaseRepository } from "@sentzunhat/zacatl/infrastructure";
import { CustomError } from "@sentzunhat/zacatl/build/error/index";
```

You can migrate imports gradually as you work on different parts of your codebase.

---

## Full Exports Map

For advanced use cases, here's the complete exports configuration:

```json
{
  "exports": {
    ".": {
      "import": "./build/index.js",
      "types": "./build/index.d.ts"
    },
    "./infrastructure": {
      "import": "./build/service/architecture/infrastructure/repositories/abstract.js",
      "types": "./build/service/architecture/infrastructure/repositories/abstract.d.ts"
    },
    "./domain": {
      "import": "./build/service/architecture/domain/index.js",
      "types": "./build/service/architecture/domain/index.d.ts"
    },
    "./application": {
      "import": "./build/service/architecture/application/index.js",
      "types": "./build/service/architecture/application/index.d.ts"
    },
    "./errors": {
      "import": "./build/error/index.js",
      "types": "./build/error/index.d.ts"
    },
    "./config": {
      "import": "./build/configuration/index.js",
      "types": "./build/configuration/index.d.ts"
    },
    "./build/*": "./build/*",
    "./package.json": "./package.json"
  }
}
```

---

## FAQ

### Do I need to update my code?

**No.** This release is backward compatible. Old import paths continue to work.

### Should I use the new shortcuts?

**Yes, when convenient.** They make code more readable and maintainable.

### Will this affect my bundle size?

**No.** Tree-shaking works the same (or better) with the new exports.

### Can I access internal modules?

**Yes.** The `./build/*` export allows access to any internal module if needed.

---

## Support

If you encounter issues during migration:

1. Check that you're on v0.0.21: `npm list @sentzunhat/zacatl`
2. Review the [v0.0.20 migration guide](./v0.0.20.md) if upgrading from earlier versions
3. See the [documentation](../README.md) for more examples
4. Open an issue on [GitHub](https://github.com/sentzunhat/zacatl/issues)

---

**Next:** [General Migration Guide](./general-guide.md)
