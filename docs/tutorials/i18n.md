# Internationalization (i18n)

Add multi-language support to your application using i18n-node.

## Module Structure

Zacatl's localization module is organized for maximum developer experience:

```
src/localization/
├── adapters/       # Translation loaders (Filesystem, Memory, custom)
├── core/           # Factory functions (createI18n, etc.)
├── i18n-node/      # HTTP request localization (singleton)
├── locales/        # Built-in translations
├── schemas/        # Validation schemas
└── types/          # Type definitions
```

## Quick Start (i18n-node)

```typescript
import { configureI18nNode } from "@sentzunhat/zacatl";
import i18n from "@sentzunhat/zacatl/third-party/i18n";

configureI18nNode({
  locales: {
    default: "en",
    supported: ["en", "es", "fr"],
    directories: ["./locales", "./custom-locales"],
  },
  objectNotation: true, // Support nested keys like "errors.notFound"
  overrideBuiltIn: true, // Your translations override Zacatl's
});

const greeting = i18n.__("greeting");
console.log(greeting); // "Hello"
```

## Translation Files

Create translation files in `src/localization/locales/`:

**en.json**:

```json
{
  "greeting": "Hello {{name}}",
  "errors": {
    "notFound": "Not found",
    "validation": "Invalid input"
  },
  "messages": {
    "welcome": "Welcome to our app!"
  }
}
```

**es.json**:

```json
{
  "greeting": "Hola {{name}}",
  "errors": {
    "notFound": "No encontrado",
    "validation": "Entrada inválida"
  },
  "messages": {
    "welcome": "¡Bienvenido a nuestra aplicación!"
  }
}
```

## With Interpolation

```typescript
const message = i18n.__("greeting", { name: "John" });
console.log(message); // "Hello John"

await i18n.setLocale("es");
console.log(i18n.__("greeting", { name: "Juan" })); // "Hola Juan"
```

## Custom Adapter (API-based)

Load translations from an API:

```typescript
import { createI18n } from "@sentzunhat/zacatl";
import type { I18nPort } from "@sentzunhat/zacatl";

class ApiAdapter implements I18nPort {
  async loadResources(language: string, namespace: string) {
    const response = await fetch(
      `https://api.example.com/translations/${language}/${namespace}`,
    );
    return response.json();
  }

  async saveResources(
    language: string,
    namespace: string,
    resources: Record<string, unknown>,
  ) {
    await fetch(
      `https://api.example.com/translations/${language}/${namespace}`,
      {
        method: "POST",
        body: JSON.stringify(resources),
      },
    );
  }
}

const i18n = createI18n(new ApiAdapter());
```

## Memory Adapter (Testing)

Use in-memory translations for tests:

```typescript
import { MemoryAdapter, createI18n } from "@sentzunhat/zacatl";

const i18n = createI18n(
  new MemoryAdapter({
    en: { translation: { greeting: "Hello" } },
    es: { translation: { greeting: "Hola" } },
  }),
);
```

## Global Instance

Set up i18n globally:

```typescript
import { createI18n, setGlobalI18n } from "@sentzunhat/zacatl";

// On app startup
const i18n = createI18n();
setGlobalI18n(i18n);

// Anywhere in your app
import { getI18nOrThrow } from "@sentzunhat/zacatl";
const i18n = getI18nOrThrow();
const message = i18n.t("greeting");
```

## Detect User Language

```typescript
import { createI18n } from "@sentzunhat/zacatl";

const i18n = createI18n();

// From HTTP header
app.use((req, res, next) => {
  const lang = req.headers["accept-language"]?.split(",")[0] || "en";
  i18n.setLanguage(lang);
  next();
});

// From user settings
const userLang = await getUserPreferredLanguage(userId);
await i18n.setLanguage(userLang);
```

## Best Practices

✅ **Organize by feature** - `errors.notFound`, `users.welcome`
✅ **Use interpolation** - `{{name}}` for dynamic values
✅ **Set default language** - Fallback to English
✅ **Keep keys consistent** - Same structure across languages
❌ **Don't hardcode strings** - Always use translation keys

## Supported Adapters

| Adapter             | Use Case                        |
| ------------------- | ------------------------------- |
| `FilesystemAdapter` | Load from JSON files (default)  |
| `MemoryAdapter`     | In-memory for testing           |
| Custom              | API, database, or other sources |

**Next**: [Testing →](./07-testing.md)
