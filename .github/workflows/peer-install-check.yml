name: Peer install check

on:
  push: {}
  pull_request: {}

jobs:
  peer-install:
    name: Install peers and verify imports
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "24"

      - name: Install devDependencies
        run: npm ci

      - name: Install peerDependencies declared in package.json
        run: |
          node -e "const p=require('./package.json').peerDependencies||{}; const pkgs=Object.keys(p).map(k=>`${k}@${p[k]}`).join(' '); if(pkgs){console.log('Installing peers:',pkgs); require('child_process').execSync('npm install --no-audit --no-fund -s '+pkgs,{stdio:'inherit'});} else console.log('No peers to install');"

      - name: Verify peers can be imported
        run: npx tsx scripts/check-peers.ts
